(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6680:function(e,t,s){Promise.resolve().then(s.bind(s,2847))},2847:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return O}});var i,a=s(7437),n=s(2265),r=s(9227),o=s(4111),d=s(5266),l=s(9299),h=s(9872),c=s(3975),p=s(5551),m=s(8751),x=s(6398);let g=e=>{let{onSubmit:t,disabled:s}=e,[i,r]=(0,n.useState)("");return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("form",{noValidate:!0,autoComplete:"off",style:{display:"flex",justifyContent:"center",width:"95%",margin:"0 auto"},onSubmit:e=>{e.preventDefault(),r(""),t(i)},children:[(0,a.jsx)(m.Z,{disabled:s,id:"standard-text",label:"input message",variant:"standard",fullWidth:!0,value:i,onChange:e=>{r(e.target.value)}}),(0,a.jsx)(p.Z,{variant:"contained",color:"primary",disabled:s,onClick:e=>{e.preventDefault(),r(""),t(i)},children:(0,a.jsx)(x.Z,{})})]})})};var f=s(3283),u=s(2126);let j={messageRow:{display:"flex"},messageRowRight:{display:"flex",justifyContent:"flex-end"},messageBlue:{position:"relative",marginLeft:"20px",marginBottom:"10px",padding:"10px",backgroundColor:"#A8DDFD",width:"60%",textAlign:"left",font:"400 .9em 'Open Sans', sans-serif",border:"1px solid #97C6E3",borderRadius:"10px","&:after":{content:"''",position:"absolute",width:"0",height:"0",borderTop:"15px solid #A8DDFD",borderLeft:"15px solid transparent",borderRight:"15px solid transparent",top:"0",left:"-15px"},"&:before":{content:"''",position:"absolute",width:"0",height:"0",borderTop:"17px solid #97C6E3",borderLeft:"16px solid transparent",borderRight:"16px solid transparent",top:"-1px",left:"-17px"}},messageOrange:{position:"relative",marginRight:"20px",marginBottom:"10px",padding:"10px",backgroundColor:"#f8e896",width:"60%",textAlign:"left",font:"400 .9em 'Open Sans', sans-serif",border:"1px solid #dfd087",borderRadius:"10px","&:after":{content:"''",position:"absolute",width:"0",height:"0",borderTop:"15px solid #f8e896",borderLeft:"15px solid transparent",borderRight:"15px solid transparent",top:"0",right:"-15px"},"&:before":{content:"''",position:"absolute",width:"0",height:"0",borderTop:"17px solid #dfd087",borderLeft:"16px solid transparent",borderRight:"16px solid transparent",top:"-1px",right:"-17px"}},messageContent:{padding:0,margin:0},messageTimeStampRight:{position:"absolute",fontSize:".85em",fontWeight:"300",marginTop:"10px",bottom:"-3px",right:"5px"},orange:{backgroundColor:u.Z[500]},avatarNothing:{color:"transparent",backgroundColor:"transparent"},displayName:{marginLeft:"20px"}},b=e=>{let t=e.message?e.message:"no message",s=e.timestamp?e.timestamp:"",i=e.photoURL?e.photoURL:"dummy.js",n=e.displayName?e.displayName:"";return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{style:j.messageRow,children:[(0,a.jsx)(f.Z,{alt:n,style:j.orange,src:i}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:j.displayName,children:n}),(0,a.jsxs)("div",{style:j.messageBlue,children:[(0,a.jsx)("div",{children:(0,a.jsx)("p",{style:j.messageContent,children:t})}),(0,a.jsx)("div",{style:j.messageTimeStampRight,children:s})]})]})]})})},v=e=>{let t=e.message?e.message:"no message",s=e.timestamp?e.timestamp:"";return(0,a.jsx)("div",{style:j.messageRowRight,children:(0,a.jsxs)("div",{style:j.messageOrange,children:[(0,a.jsx)("p",{style:j.messageContent,children:t}),(0,a.jsx)("div",{style:j.messageTimeStampRight,children:s})]})})};var y=s(1872);let w={container:{height:"calc(100vh - 64px)",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",position:"relative"},messagesBody:{width:"100%",margin:"0 0 12px 0",height:"calc(100vh - 124px)",overflow:"scroll"}},Z={id:"",name:"anonymous",avatar:""};function C(e,t){let s=t.find(t=>t.id===e.from)||Z;return{id:e.id,body:e.body,name:s.name,avatar:s.avatar,timeCreated:e.timeCreated}}function S(e){let{data:{me:t,users:s,messages:r},chatId:o}=e,[d,l]=(0,n.useState)(r.filter(e=>e.chatId==o).map(e=>C(e,s))),[m,x]=(0,n.useState)(!1);return(0,n.useEffect)(()=>((i=new WebSocket("ws://localhost:8080/ws?authentication=".concat(t.id))).onopen=e=>{x(!1)},i.onclose=e=>{x(!0)},i.onerror=e=>{console.error(e)},i.onmessage=function(e){let t=JSON.parse(e.data),i=C(t,s);l(e=>[...e,i])},i.readyState==i.CLOSED&&x(!0),()=>{console.log("ws closed"),i.close()}),[t]),(0,a.jsxs)("div",{id:"111",style:w.container,children:[(0,a.jsx)(h.Z,{id:"style-1",sx:w.messagesBody,children:d.map(e=>e.name==t.name?(0,a.jsx)(v,{message:e.body,timestamp:"",photoURL:e.avatar,displayName:"",avatarDisp:!0},e.id):(0,a.jsx)(b,{message:e.body,timestamp:"",photoURL:e.avatar,displayName:"",avatarDisp:!0},e.id))}),(0,a.jsx)(g,{disabled:m,onSubmit:e=>{let s={id:(0,y.Z)(),chatId:o,body:e.trim(),from:t.id};i.send(JSON.stringify(s))}}),(0,a.jsx)(c.Z,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:m&&null!=window,onClose:()=>window.location.reload(),message:"Disconnected, refresh page to retry",action:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(p.Z,{color:"secondary",size:"small",onClick:()=>window.location.reload(),children:"REFRESH"})})})]})}var R=s(2502),k=s(3393),D=s(1341),L=s(1396),N=s.n(L),P=s(4404);function O(){var e;let[t,s]=(0,n.useState)({users:[],me:Z,messages:[],chats:[]}),[i,h]=(0,n.useState)(!0),[c,p]=(0,n.useState)(null),[m,x]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{fetch("http://localhost:8080/data").then(e=>e.json()).then(e=>{var t;let i=e.chats||[];p((null===(t=i[0])||void 0===t?void 0:t.id)||null),s({users:e.users,me:e.me,messages:e.messages||[],chats:i}),h(!1)}).catch(e=>{x(!0),h(!1)})},[]),m)?(0,a.jsx)(r.Z,{sx:{display:"flex"},children:(0,a.jsx)(r.Z,{sx:{width:"100%",textAlign:"center",paddingTop:10},children:"Fetch data from server failed. Check server status pls, then refresh page to continue."})}):(0,a.jsxs)(r.Z,{sx:{display:"flex"},children:[(0,a.jsx)(r.Z,{sx:{width:"100%"},children:i?"loading...":(0,a.jsx)(S,{chatId:c||"",data:t})}),(0,a.jsx)(o.ZP,{sx:{width:320,flexShrink:0,"& .MuiDrawer-paper":{width:320,boxSizing:"border-box",top:["48px","56px","64px"],height:"auto",bottom:0}},variant:"permanent",anchor:"right",children:!i&&(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(l.ZP,{disablePadding:!0,children:(0,a.jsxs)(R.Z,{component:N(),href:"/",children:[(0,a.jsx)(k.Z,{children:(0,a.jsx)(f.Z,{children:(0,a.jsx)("img",{src:null===(e=t.me)||void 0===e?void 0:e.avatar,height:40,width:40})})}),(0,a.jsx)(D.Z,{primary:t.me.name})]})}),(0,a.jsx)(l.ZP,{children:(0,a.jsx)(D.Z,{primary:"recent chats:"})}),t.chats.map(e=>{let{id:s,botId:i}=e,n=t.users.find(e=>e.id==i);if(n)return(0,a.jsx)(l.ZP,{disablePadding:!0,children:(0,a.jsxs)(R.Z,{disabled:s==c,component:N(),href:"/",onClick:()=>p(s),children:[(0,a.jsx)(k.Z,{children:(0,a.jsx)(f.Z,{style:{width:30,height:30},children:(0,a.jsx)("img",{src:n.avatar,height:30,width:30})})}),(0,a.jsx)(k.Z,{children:(0,a.jsx)(f.Z,{style:{width:30,height:30},children:(0,a.jsx)("img",{src:t.me.avatar,height:30,width:30})})})]})},s)}),(0,a.jsx)(P.Z,{}),(0,a.jsx)(l.ZP,{disablePadding:!0,children:(0,a.jsx)(R.Z,{component:N(),href:"/",onClick:()=>{fetch("http://localhost:8080/review?authentication=".concat(t.me.id),{method:"POST"})},children:(0,a.jsx)(D.Z,{primary:"Trigger sample review flow!"})})}),(0,a.jsx)(l.ZP,{disablePadding:!0,children:(0,a.jsx)(R.Z,{component:N(),href:"/",onClick:async()=>{let e=await fetch("http://localhost:8080/logs?authentication=".concat(t.me.id)).then(e=>e.text());console.log(e)},children:(0,a.jsx)(D.Z,{primary:"Log all domain events to console!"})})})]})})]})}}},function(e){e.O(0,[846,626,971,596,744],function(){return e(e.s=6680)}),_N_E=e.O()}]);