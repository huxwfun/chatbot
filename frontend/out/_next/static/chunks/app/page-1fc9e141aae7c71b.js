(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6680:function(e,t,s){Promise.resolve().then(s.bind(s,2847))},2847:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return E}});var a,i=s(7437),n=s(2265),r=s(9227),o=s(4111),d=s(5266),l=s(9299),h=s(9872),c=s(3975),p=s(5551),m=s(8751),x=s(6398);let g=e=>{let{onSubmit:t,disabled:s}=e,[a,r]=(0,n.useState)("");return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("form",{noValidate:!0,autoComplete:"off",style:{display:"flex",justifyContent:"center",width:"95%",margin:"0 auto"},onSubmit:e=>{e.preventDefault(),r(""),t(a)},children:[(0,i.jsx)(m.Z,{disabled:s,id:"standard-text",label:"input message",variant:"standard",fullWidth:!0,value:a,onChange:e=>{r(e.target.value)}}),(0,i.jsx)(p.Z,{variant:"contained",color:"primary",disabled:s,onClick:e=>{e.preventDefault(),r(""),t(a)},children:(0,i.jsx)(x.Z,{})})]})})};var f=s(3283),u=s(2126);let j={messageRow:{display:"flex"},messageRowRight:{display:"flex",justifyContent:"flex-end"},messageBlue:{position:"relative",marginLeft:"20px",marginBottom:"10px",padding:"10px",backgroundColor:"#A8DDFD",width:"60%",textAlign:"left",font:"400 .9em 'Open Sans', sans-serif",border:"1px solid #97C6E3",borderRadius:"10px","&:after":{content:"''",position:"absolute",width:"0",height:"0",borderTop:"15px solid #A8DDFD",borderLeft:"15px solid transparent",borderRight:"15px solid transparent",top:"0",left:"-15px"},"&:before":{content:"''",position:"absolute",width:"0",height:"0",borderTop:"17px solid #97C6E3",borderLeft:"16px solid transparent",borderRight:"16px solid transparent",top:"-1px",left:"-17px"}},messageOrange:{position:"relative",marginRight:"20px",marginBottom:"10px",padding:"10px",backgroundColor:"#f8e896",width:"60%",textAlign:"left",font:"400 .9em 'Open Sans', sans-serif",border:"1px solid #dfd087",borderRadius:"10px","&:after":{content:"''",position:"absolute",width:"0",height:"0",borderTop:"15px solid #f8e896",borderLeft:"15px solid transparent",borderRight:"15px solid transparent",top:"0",right:"-15px"},"&:before":{content:"''",position:"absolute",width:"0",height:"0",borderTop:"17px solid #dfd087",borderLeft:"16px solid transparent",borderRight:"16px solid transparent",top:"-1px",right:"-17px"}},messageContent:{padding:0,margin:0},messageTimeStampRight:{position:"absolute",fontSize:".85em",fontWeight:"300",marginTop:"10px",bottom:"-3px",right:"5px"},orange:{backgroundColor:u.Z[500]},avatarNothing:{color:"transparent",backgroundColor:"transparent"},displayName:{marginLeft:"20px"}},b=e=>{let t=e.message?e.message:"no message",s=e.timestamp?e.timestamp:"",a=e.photoURL?e.photoURL:"dummy.js",n=e.displayName?e.displayName:"";return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{style:j.messageRow,children:[(0,i.jsx)(f.Z,{alt:n,style:j.orange,src:a}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:j.displayName,children:n}),(0,i.jsxs)("div",{style:j.messageBlue,children:[(0,i.jsx)("div",{children:(0,i.jsx)("p",{style:j.messageContent,children:t})}),(0,i.jsx)("div",{style:j.messageTimeStampRight,children:s})]})]})]})})},v=e=>{let t=e.message?e.message:"no message",s=e.timestamp?e.timestamp:"";return(0,i.jsx)("div",{style:j.messageRowRight,children:(0,i.jsxs)("div",{style:j.messageOrange,children:[(0,i.jsx)("p",{style:j.messageContent,children:t}),(0,i.jsx)("div",{style:j.messageTimeStampRight,children:s})]})})};var y=s(1872);let w={container:{height:"calc(100vh - 64px)",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",position:"relative"},messagesBody:{width:"100%",margin:"0 0 12px 0",height:"calc(100vh - 124px)",overflow:"scroll"}},Z={id:"",name:"anonymous",avatar:""};function C(e,t){let s=t.find(t=>t.id===e.from)||Z;return{id:e.id,body:e.body,name:s.name,avatar:s.avatar,timeCreated:e.timeCreated}}function S(e){let{data:{me:t,users:s,messages:r},chatId:o}=e,[d,l]=(0,n.useState)(r.filter(e=>e.chatId==o).map(e=>C(e,s))),[m,x]=(0,n.useState)(!1);return(0,n.useEffect)(()=>((a=new WebSocket("ws://localhost:8080/ws?authentication=".concat(t.id))).onopen=e=>{x(!1)},a.onclose=e=>{x(!0)},a.onerror=e=>{console.error(e)},a.onmessage=function(e){let t=JSON.parse(e.data),a=C(t,s);l(e=>[...e,a])},a.readyState==a.CLOSED&&x(!0),()=>{console.log("ws closed"),a.close()}),[t]),(0,i.jsxs)("div",{id:"111",style:w.container,children:[(0,i.jsx)(h.Z,{id:"style-1",sx:w.messagesBody,children:d.map(e=>e.name==t.name?(0,i.jsx)(v,{message:e.body,timestamp:"",photoURL:e.avatar,displayName:"",avatarDisp:!0},e.id):(0,i.jsx)(b,{message:e.body,timestamp:"",photoURL:e.avatar,displayName:"",avatarDisp:!0},e.id))}),(0,i.jsx)(g,{disabled:m,onSubmit:e=>{let s={id:(0,y.Z)(),chatId:o,body:e.trim(),from:t.id};a.send(JSON.stringify(s))}}),(0,i.jsx)(c.Z,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:m&&null!=window,onClose:()=>window.location.reload(),message:"Disconnected, refresh page to retry",action:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(p.Z,{color:"secondary",size:"small",onClick:()=>window.location.reload(),children:"REFRESH"})})})]})}var R=s(2502),k=s(3393),D=s(7780),N=s(1396),O=s.n(N),P=s(4404),L=s(9609),T=s(3226);function E(){var e;let[t,s]=(0,n.useState)({users:[],me:Z,messages:[],chats:[]}),[a,h]=(0,n.useState)(!0),[c,p]=(0,n.useState)(null),[m,x]=(0,n.useState)(!1),[g,u]=(0,n.useState)("");return((0,n.useEffect)(()=>{fetch("http://localhost:8080/data").then(e=>e.json()).then(e=>{var t;let a=e.chats||[];p((null===(t=a[0])||void 0===t?void 0:t.id)||null),s({users:e.users,me:e.me,messages:e.messages||[],chats:a}),h(!1)}).catch(e=>{x(!0),h(!1)})},[]),console.log(g),m)?(0,i.jsx)(r.Z,{sx:{display:"flex"},children:(0,i.jsx)(r.Z,{sx:{width:"100%",textAlign:"center",paddingTop:10},children:"Fetch data from server failed. Check server status pls, then refresh page to continue."})}):(0,i.jsxs)(r.Z,{sx:{display:"flex"},children:[(0,i.jsx)(r.Z,{sx:{width:"100%"},children:a?"loading...":(0,i.jsx)(S,{chatId:c||"",data:t})}),(0,i.jsx)(o.ZP,{sx:{width:320,flexShrink:0,"& .MuiDrawer-paper":{width:320,boxSizing:"border-box",top:["48px","56px","64px"],height:"auto",bottom:0}},variant:"permanent",anchor:"right",children:!a&&(0,i.jsxs)(d.Z,{children:[(0,i.jsx)(l.ZP,{disablePadding:!0,children:(0,i.jsxs)(R.Z,{component:O(),href:"/",children:[(0,i.jsx)(k.Z,{children:(0,i.jsx)(f.Z,{children:(0,i.jsx)("img",{src:null===(e=t.me)||void 0===e?void 0:e.avatar,height:40,width:40})})}),(0,i.jsx)(D.Z,{primary:t.me.name})]})}),(0,i.jsx)(l.ZP,{children:(0,i.jsx)(D.Z,{primary:"recent chats:"})}),t.chats.map(e=>{let{id:s,botId:a}=e,n=t.users.find(e=>e.id==a);if(n)return(0,i.jsx)(l.ZP,{disablePadding:!0,children:(0,i.jsxs)(R.Z,{disabled:s==c,component:O(),href:"/",onClick:()=>p(s),children:[(0,i.jsx)(k.Z,{children:(0,i.jsx)(f.Z,{style:{width:30,height:30},children:(0,i.jsx)("img",{src:n.avatar,height:30,width:30})})}),(0,i.jsx)(k.Z,{children:(0,i.jsx)(f.Z,{style:{width:30,height:30},children:(0,i.jsx)("img",{src:t.me.avatar,height:30,width:30})})})]})},s)}),(0,i.jsx)(P.Z,{}),(0,i.jsx)(l.ZP,{disablePadding:!0,children:(0,i.jsx)(R.Z,{component:O(),href:"/",onClick:()=>{fetch("http://localhost:8080/review?authentication=".concat(t.me.id),{method:"POST"})},children:(0,i.jsx)(D.Z,{primary:"Trigger sample review flow!"})})}),(0,i.jsx)(l.ZP,{disablePadding:!0,children:(0,i.jsx)(R.Z,{component:O(),href:"/",onClick:async()=>{let e=await fetch("http://localhost:8080/logs?authentication=".concat(t.me.id)).then(e=>e.text());u(e)},children:(0,i.jsx)(D.Z,{primary:"See all domain event logs"})})})]})}),(0,i.jsx)(L.Z,{open:g.length>0,onClose:()=>u(""),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,i.jsx)(r.Z,{sx:{position:"absolute",top:"50%",left:"50%",width:"80%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,maxHeight:"60%",overflowY:"scroll"},children:g.split("\n").map((e,t)=>e.indexOf("---")>-1?(0,i.jsx)(T.Z,{variant:"h6",gutterBottom:!0,children:e},t):(0,i.jsx)(T.Z,{gutterBottom:e.startsWith("from state"),children:e||" "},t))})})]})}}},function(e){e.O(0,[846,309,971,596,744],function(){return e(e.s=6680)}),_N_E=e.O()}]);