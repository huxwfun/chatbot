(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6680:function(e,t,s){Promise.resolve().then(s.bind(s,2714))},2714:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return F}});var i,a=s(7437),n=s(2265),o=s(9227),r=s(4111),l=s(5266),d=s(9299),c=s(9872),h=s(7292),m=s(5551),p=s(4213),x=s(6398);let g=e=>{let{onSubmit:t,disabled:s}=e,[i,o]=(0,n.useState)("");return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("form",{noValidate:!0,autoComplete:"off",style:{display:"flex",justifyContent:"center",width:"95%",margin:"0 auto"},onSubmit:e=>{e.preventDefault(),o(""),t(i)},children:[(0,a.jsx)(p.Z,{disabled:s,id:"standard-text",label:"input message",variant:"standard",fullWidth:!0,value:i,onChange:e=>{o(e.target.value)}}),(0,a.jsx)(m.Z,{variant:"contained",color:"primary",disabled:s,onClick:e=>{e.preventDefault(),o(""),t(i)},children:(0,a.jsx)(x.Z,{})})]})})};var u=s(3283),f=s(2126),v=s(9588);let b={messageRow:{display:"flex"},messageRowRight:{display:"flex",justifyContent:"flex-end"},messageBlue:{position:"relative",marginLeft:"20px",marginBottom:"10px",padding:"10px",backgroundColor:"#A8DDFD",width:"60%",textAlign:"left",font:"400 .9em 'Open Sans', sans-serif",border:"1px solid #97C6E3",borderRadius:"10px","&:after":{content:"''",position:"absolute",width:"0",height:"0",borderTop:"15px solid #A8DDFD",borderLeft:"15px solid transparent",borderRight:"15px solid transparent",top:"0",left:"-15px"},"&:before":{content:"''",position:"absolute",width:"0",height:"0",borderTop:"17px solid #97C6E3",borderLeft:"16px solid transparent",borderRight:"16px solid transparent",top:"-1px",left:"-17px"}},messageOrange:{position:"relative",marginRight:"20px",marginBottom:"10px",padding:"10px",backgroundColor:"#f8e896",width:"60%",textAlign:"left",font:"400 .9em 'Open Sans', sans-serif",border:"1px solid #dfd087",borderRadius:"10px","&:after":{content:"''",position:"absolute",width:"0",height:"0",borderTop:"15px solid #f8e896",borderLeft:"15px solid transparent",borderRight:"15px solid transparent",top:"0",right:"-15px"},"&:before":{content:"''",position:"absolute",width:"0",height:"0",borderTop:"17px solid #dfd087",borderLeft:"16px solid transparent",borderRight:"16px solid transparent",top:"-1px",right:"-17px"}},messageContent:{padding:0,margin:0},messageTimeStampRight:{position:"absolute",fontSize:".85em",fontWeight:"300",marginTop:"10px",bottom:"-3px",right:"5px"},orange:{backgroundColor:f.Z[500]},avatarNothing:{color:"transparent",backgroundColor:"transparent"},displayName:{marginLeft:"20px"}},j=e=>{let t=e.message?e.message:"no message",s=e.timestamp?e.timestamp:"",i=e.photoURL?e.photoURL:"dummy.js",n=e.displayName?e.displayName:"";return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{style:b.messageRow,children:[(0,a.jsx)(u.Z,{alt:n,style:b.orange,src:i}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:b.displayName,children:n}),(0,a.jsxs)("div",{style:b.messageBlue,children:[(0,a.jsx)(v.D,{children:t}),(0,a.jsx)("div",{style:b.messageTimeStampRight,children:s})]})]})]})})},w=e=>{let t=e.message?e.message:"no message";return e.timestamp&&e.timestamp,(0,a.jsx)("div",{style:b.messageRowRight,children:(0,a.jsx)("div",{style:b.messageOrange,children:(0,a.jsx)(v.D,{children:t})})})};var y=s(1872);s(2601).env.NEXT_PUBLIC_API_PREFIX;let Z={container:{height:"calc(100vh - 64px)",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",position:"relative"},messagesBody:{width:"100%",margin:"0 0 12px 0",height:"calc(100vh - 124px)",overflow:"scroll"}},S={id:"",name:"anonymous",avatar:""};function C(e,t){let s=t.find(t=>t.id===e.from)||S;return{id:e.id,body:e.body,name:s.name,avatar:s.avatar,timeCreated:e.timeCreated}}function R(e){let{data:{me:t,users:s,messages:o},chatId:r}=e,[l,d]=(0,n.useState)(o.filter(e=>e.chatId==r).map(e=>C(e,s))),[p,x]=(0,n.useState)(!1),u=(0,n.useRef)(null);return(0,n.useEffect)(()=>{var e,a,n;return(i=new WebSocket("".concat("".concat((null===(e=window)||void 0===e?void 0:e.location.protocol.startsWith("https"))?"wss":"ws","://").concat(null===(a=window)||void 0===a?void 0:a.location.hostname,":").concat(null===(n=window)||void 0===n?void 0:n.location.port),"/ws?authentication=").concat(t.id))).onopen=e=>{x(!1)},i.onclose=e=>{x(!0)},i.onerror=e=>{console.error(e)},i.onmessage=function(e){let t=JSON.parse(e.data),i=C(t,s);d(e=>[...e,i])},i.readyState==i.CLOSED&&x(!0),()=>{console.log("ws closed"),i.close()}},[t]),(0,n.useEffect)(()=>{var e,t;null==u||null===(t=u.current)||void 0===t||t.scroll({top:null==u?void 0:null===(e=u.current)||void 0===e?void 0:e.scrollHeight,behavior:"smooth"})},[l]),(0,a.jsxs)("div",{id:"111",style:Z.container,children:[(0,a.jsx)(c.Z,{id:"style-1",ref:u,sx:Z.messagesBody,children:l.map(e=>e.name==t.name?(0,a.jsx)(w,{message:e.body,timestamp:"",photoURL:e.avatar,displayName:"",avatarDisp:!0},e.id):(0,a.jsx)(j,{message:e.body,timestamp:"",photoURL:e.avatar,displayName:"",avatarDisp:!0},e.id))}),(0,a.jsx)(g,{disabled:p,onSubmit:e=>{let s={id:(0,y.Z)(),chatId:r,body:e.trim(),from:t.id};i.send(JSON.stringify(s))}}),(0,a.jsx)(h.Z,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:p&&null!=window,onClose:()=>window.location.reload(),message:"Disconnected, refresh page to retry",action:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(m.Z,{color:"secondary",size:"small",onClick:()=>window.location.reload(),children:"REFRESH"})})})]})}var k=s(2502),D=s(3393),E=s(1341),N=s(1396),L=s.n(N),O=s(4404),P=s(4982),T=s(1090),_=s(2982);function F(){var e;let[t,s]=(0,n.useState)({users:[],me:S,messages:[],chats:[]}),[i,c]=(0,n.useState)(!0),[h,m]=(0,n.useState)(null),[p,x]=(0,n.useState)(!1),[g,f]=(0,n.useState)("");return((0,n.useEffect)(()=>{fetch("".concat("","/data")).then(e=>e.json()).then(e=>{var t;let i=e.chats||[];m((null===(t=i[0])||void 0===t?void 0:t.id)||null),s({users:e.users,me:e.me,messages:e.messages||[],chats:i}),c(!1)}).catch(e=>{x(!0),c(!1)})},[]),p)?(0,a.jsx)(o.Z,{sx:{display:"flex"},children:(0,a.jsx)(o.Z,{sx:{width:"100%",textAlign:"center",paddingTop:10},children:"Fetch data from server failed. Check server status pls, then refresh page to continue."})}):(0,a.jsxs)(o.Z,{sx:{display:"flex"},children:[(0,a.jsx)(o.Z,{sx:{width:"100%"},children:i?"loading...":(0,a.jsx)(R,{chatId:h||"",data:t})}),(0,a.jsxs)(r.ZP,{sx:{width:320,flexShrink:0,"& .MuiDrawer-paper":{width:320,boxSizing:"border-box",top:["48px","56px","64px"],height:"auto",bottom:0}},variant:"permanent",anchor:"right",children:[!i&&(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(d.ZP,{disablePadding:!0,children:(0,a.jsxs)(k.Z,{component:L(),href:"/",children:[(0,a.jsx)(D.Z,{children:(0,a.jsx)(u.Z,{children:(0,a.jsx)("img",{src:null===(e=t.me)||void 0===e?void 0:e.avatar,height:40,width:40})})}),(0,a.jsx)(E.Z,{primary:t.me.name})]})}),(0,a.jsx)(d.ZP,{children:(0,a.jsx)(E.Z,{primary:"recent chats:"})}),t.chats.map(e=>{let{id:s,botId:i}=e,n=t.users.find(e=>e.id==i);if(n)return(0,a.jsx)(d.ZP,{disablePadding:!0,children:(0,a.jsxs)(k.Z,{disabled:s==h,component:L(),href:"/",onClick:()=>m(s),children:[(0,a.jsx)(D.Z,{children:(0,a.jsx)(u.Z,{style:{width:30,height:30},children:(0,a.jsx)("img",{src:n.avatar,height:30,width:30})})}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(u.Z,{style:{width:30,height:30},children:(0,a.jsx)("img",{src:t.me.avatar,height:30,width:30})})})]})},s)}),(0,a.jsx)(O.Z,{})]}),(0,a.jsxs)(o.Z,{sx:{position:"absolute",bottom:24},children:[(0,a.jsxs)(T.Z,{variant:"extended",size:"small",sx:{mt:5,ml:1,mr:1},onClick:async()=>{let e=await fetch("".concat("","/instruction?authentication=").concat(t.me.id)).then(e=>e.text());f(e)},children:[(0,a.jsx)(_.Z,{color:"primary",sx:{mr:1}}),"Show instructions!"]}),(0,a.jsxs)(T.Z,{variant:"extended",size:"small",sx:{mt:1,ml:1,mr:1},onClick:()=>{fetch("".concat("","/review?authentication=").concat(t.me.id),{method:"POST"})},children:[(0,a.jsx)(_.Z,{color:"secondary",sx:{mr:1}}),"Start review!"]}),(0,a.jsxs)(T.Z,{variant:"extended",size:"small",sx:{mt:1,ml:1,mr:1},onClick:async()=>{let e=await fetch("".concat("","/logs?authentication=").concat(t.me.id)).then(e=>e.text());f(e)},children:[(0,a.jsx)(_.Z,{sx:{mr:1}}),"Show event logs"]})]})]}),(0,a.jsx)(P.Z,{open:g.length>0,onClose:()=>f(""),"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,a.jsx)(o.Z,{sx:{position:"absolute",top:"50%",left:"50%",width:"80%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4,maxHeight:"60%",overflowY:"scroll"},children:(0,a.jsx)(v.D,{children:g})})})]})}}},function(e){e.O(0,[475,115,971,596,744],function(){return e(e.s=6680)}),_N_E=e.O()}]);